<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Snake - Saboor's Global Rage</title>
    <style>
        body {
            background-color: #0d0221;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; color: #00f2ff;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden; user-select: none;
        }
        #start-screen, #pause-overlay, #leaderboard-screen {
            position: absolute; background: rgba(15, 5, 36, 0.98);
            padding: 40px; border: 3px solid #00f2ff; text-align: center;
            z-index: 100; box-shadow: 0 0 50px #00f2ff;
        }
        #pause-overlay, #leaderboard-screen { display: none; }
        
        .credits {
            position: absolute; bottom: 10px; right: 15px;
            font-size: 12px; color: #00f2ff; opacity: 0.7;
            text-shadow: 0 0 5px #00f2ff;
        }

        .main-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toxic-wrapper {
            position: absolute;
            right: -30px; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .toxic-label {
            font-size: 10px; font-weight: bold; color: #ff0055;
            margin-bottom: 5px; text-transform: uppercase;
            writing-mode: vertical-rl; transform: rotate(180deg);
        }

        .toxic-container-vertical {
            width: 10px; height: 300px; 
            background: #1a1a3a; border: 2px solid #00f2ff;
            border-radius: 10px; position: relative;
            display: flex; flex-direction: column; justify-content: flex-end;
            overflow: hidden;
        }
        #toxic-bar {
            width: 100%; height: 0%;
            background: linear-gradient(0deg, #00f2ff, #ff0055);
            transition: height 0.3s ease;
        }

        input {
            background: #16213e; border: 2px solid #00f2ff; color: white;
            padding: 12px; margin-bottom: 25px; width: 220px;
            text-align: center; font-size: 18px; outline: none;
            display: block; margin: 20px auto;
        }

        button {
            background: #ff0055; color: white; border: none;
            padding: 15px 35px; font-weight: bold; font-size: 20px;
            cursor: pointer; text-transform: uppercase; margin: 5px;
        }

        .stats-bar {
            display: flex; justify-content: space-between;
            width: 800px; padding: 10px 20px; font-size: 18px;
            background: rgba(0, 242, 255, 0.1); margin-bottom: 10px;
        }
        canvas { background-color: #0f0524; border: 4px solid #00f2ff; }

        #leaderboard-list { list-style: none; padding: 0; text-align: left; margin: 20px 0; font-size: 14px;}
        .lb-item { display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding: 8px 0; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="font-size: 50px; margin:0; letter-spacing: 5px;">THE SNAKE</h1>
        <input type="text" id="playerName" placeholder="name" maxlength="12">
        <button onclick="attemptStart()">A Quick Start ‚ö°</button>
        <button onclick="showLeaderboard()">LEADERBOARD üèÜ</button>
        <div class="credits">Created by Saboor üç≠</div>
    </div>

    <div id="leaderboard-screen">
        <h2 style="color:#00f2ff;">GLOBAL TOP 5</h2>
        <div id="leaderboard-list">Loading...</div>
        <button onclick="closeLeaderboard()">CLOSE</button>
    </div>

    <div id="pause-overlay">
        <h1>PAUSED</h1>
        <button onclick="togglePause()">RESUME (P)</button>
    </div>

    <div class="stats-bar">
        <div>SCORE: <span id="scoreVal">0</span></div>
        <div style="color: #ff0055;">WR: <span id="highScoreVal">0</span> BY <span id="highScoreName">NONE</span></div>
    </div>

    <div class="main-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div class="toxic-wrapper">
            <div class="toxic-label">TOXICITY</div>
            <div class="toxic-container-vertical">
                <div id="toxic-bar"></div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const DB_URL = "https://snake-competition-default-rtdb.firebaseio.com/"; 

        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // --- ROASTS ---
        const startRoasts = ["Type a name, walnut!", "Are you allergic to keyboards?", "Name box is empty!", "Identify yourself!", "Is your brain on airplane mode?", "Error 404: Player's identity not found.", "Even a goldfish has a name.", "Enter a name or go back to nursery.", "Hurry up!", "Type something!", "The input box isn't a mirror.", "Waiting... any century now.", "I can't track failures without a name.", "A name. 3 letters. Can you manage that?", "Your keyboard is for typing.", "Is this too complex?", "Don't be shy.", "Name. Now.", "System waiting for a human.", "Loading... YOU haven't typed yet.", "Just pick a name and lose.", "The snake is hungry.", "Humiliation starts with a name.", "Does your mom know you're slow?", "If you can't type, don't play.", "Input required.", "Stop staring.", "Who are you? Nobody?", "My code is faster than your brain.", "I'm literally falling asleep."];
        const crashRoasts = ["PATHETIC. JUST UNINSTALL.", "THAT WALL HAD A FAMILY!", "SCORE LOWER THAN YOUR IQ.", "EVEN THE SNAKE IS DISAPPOINTED.", "WAS THAT A COLLISION OR A CRY FOR HELP?", "RESTARTING WON'T FIX YOUR SKILL.", "EMBARRASSING.", "DO YOU NEED GLASSES?", "A POTATO HAS BETTER REFLEXES.", "MY CAT DID BETTER.", "GOLD MEDAL IN LOSING.", "YOU'RE THE REASON SHAMPOO HAS INSTRUCTIONS.", "BREAD PLAYS BETTER.", "GO PLAY TETRIS.", "THE SNAKE DIED OF SHAME.", "STOP WASTING ELECTRICITY.", "BRAVO! You hit the wall.", "TRASH CAN BE RECYCLED. YOU CAN'T.", "PHYSICALLY PAINFUL TO WATCH.", "IS YOUR MONITOR ON?", "FAILED AGAIN. SURPRISE.", "TRY LUDO.", "DON'T CRY.", "CLOWN BEHAVIOR.", "THAT WAS LAZY.", "SNAKE GO CRASH. USER GO CRY.", "ABSOLUTE GARBAGE.", "MY GRANDMA PLAYS FASTER.", "YOU HIT THE WALL LIKE IT OWED YOU MONEY.", "ERROR: SKILL NOT FOUND.", "LOGIC NOT FOUND.", "TRY USING YOUR HANDS.", "DO YOU ENJOY LOSING?", "TRAGIC.", "SADDEST ATTEMPT.", "YOU'RE NOT BUILT FOR THIS.", "QUITTING IS ALWAYS AN OPTION.", "LAGGING IN REAL LIFE.", "I'VE SEEN BOTS WITH MORE SOUL.", "JUST... WOW. BAD."];
        const backhandedPraise = ["NEW RECORD! Smartest among idiots.", "HIGH SCORE! Mom is proud.", "NEW RECORD! Luck is powerful.", "WOW! Too bad you'll never be this good at life.", "NEW HIGH SCORE! 5 seconds of glory.", "NEW RECORD! King of losers.", "NEW RECORD! Broken clock is right twice.", "NEW HIGH SCORE! Even you can win.", "AMAZING! You did something.", "NEW RECORD! Low bar.", "NEW HIGH SCORE! Your only achievement.", "WOW! Beat the ghost of failure.", "NEW RECORD! Fastest snail.", "HIGH SCORE! Have a nap.", "NEW RECORD! Now try in real life."];
        const missRoasts = ["EMOTIONAL DAMAGE!", "WHEEZE... MISS?!", "NICE WHIFF!", "LMAO, TRASH.", "DID YOU BLINK?", "SNAIL!", "GIT GUD.", "STAY MAD.", "APPLE REJECTED YOU!", "MY GRANDMA TARGETS BETTER!", "TOE PLAYER!", "STOP EMBARRASSING YOURSELF!", "MISSING IS YOUR SKILL!", "WHOOSH!", "AIR BALL!", "ALMOST... NO.", "WAKE UP!", "IS YOUR MONITOR ON?", "NICE AIM, STORMTROOPER!", "MISSED A STATIONARY OBJECT.", "HOW?!", "WOW, SPECIAL.", "CLOSE BUT NO.", "MAYBE NEXT TIME.", "SNAKE SAYS NO.", "TARGET LOST!", "BAD AT THIS.", "TRY HITTING IT.", "SAD.", "LOOK AT THE SCREEN!", "REFLEXES OF A SNAIL!", "GO TO SLEEP.", "FOCUS!", "JUST QUIT.", "SAD TO WATCH.", "HEHE, MISSED.", "ZERO SKILL.", "IMAGINE MISSING THAT.", "YOU'RE A JOKE.", "CLOWN!", "DO BETTER.", "WHY ARE YOU LIKE THIS?", "FAIL!", "SLOPPY!", "YAWN.", "BORING MISS.", "GET GOOD.", "SKILL ISSUE!", "ROOKIE MOVE.", "PATHETIC.", "SCARE THE FOOD?", "SCARED OF THE APPLE?", "IT WON'T BITE!", "TRY HARDER!", "NOT EVEN CLOSE.", "BRAIN DELAY!", "ERROR: AIM NOT FOUND.", "WHIFF OF THE CENTURY.", "TAKE A LAP.", "NEED A TUTORIAL?", "IT'S RED. HIT IT.", "HARD TO WATCH.", "I'M LOSING HOPE.", "SNAKE IS HUNGRY.", "FEED THE SNAKE!", "AFRAID OF WINNING?", "LOOSER ALERT!", "NICE MISS, GENIUS.", "YOU'RE TRYING.", "F FOR SKILL.", "STOP MISSING!", "POINTLESS.", "ZERO ACCURACY.", "BOT BEHAVIOR.", "ARE YOU A BOT.", "DEFECTIVE PLAYER.", "RETURN TO SENDER.", "GARBAGE!", "POOP REFLEXES.", "HOES MAD.", "WHIFF!", "SWISH!", "NOT TODAY.", "SNAKE SAYS LOL.", "UNLUCKY?", "PURE COMEDY!", "COMEDIAN.", "HILARIOUS MISS.", "TRY AGAIN IN 2030.", "SLOW!", "TURTLE!", "STATIONARY!", "DEAD!", "GHOSTED THE FOOD!", "FRIENDZONED THE APPLE!"];

        // --- ENGINE ---
        let snake = [{x: 400, y: 300}, {x: 380, y: 300}, {x: 360, y: 300}];
        let ghostPath = JSON.parse(localStorage.getItem("ghostData") || "[]");
        let currentPath = [];
        let dx = 20, dy = 0, totalScore = 0, gameRunning = false, isPaused = false;
        let foodX, foodY, toxicity = 0, frame = 0, isRage = false;
        let chatTimer = 0, chatMsg = "", wasNear = false, missCombo = 0, currentPlayer = "";

        // Audio Context initialization on Start
        let audioCtx;
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function sfx(f1, f2) {
            if (!audioCtx || audioCtx.state === 'suspended') return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.frequency.setValueAtTime(f1, audioCtx.currentTime);
            o.frequency.exponentialRampToValueAtTime(f2, audioCtx.currentTime + 0.1);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.connect(audioCtx.destination);
            o.connect(g);
            o.start();
            o.stop(audioCtx.currentTime + 0.1);
        }

        async function fetchGlobalHigh() {
            try {
                const response = await fetch(DB_URL + "scores.json");
                const data = await response.json();
                if (data) {
                    const sorted = Object.values(data).sort((a,b) => b.score - a.score);
                    const top = sorted[0];
                    document.getElementById("highScoreVal").innerText = top.score || 0;
                    document.getElementById("highScoreName").innerText = (top.name || "NONE").toUpperCase();
                }
            } catch(e) { console.log("Fetch Error"); }
        }

        async function saveScore(name, score) {
            if (score <= 0) return;
            try {
                await fetch(DB_URL + "scores.json", {
                    method: 'POST',
                    body: JSON.stringify({ name: name, score: score, date: new Date().toISOString() })
                });
            } catch(e) {}
        }

        async function showLeaderboard() {
            document.getElementById("leaderboard-screen").style.display = "block";
            const list = document.getElementById("leaderboard-list");
            list.innerHTML = "Fetching...";
            try {
                const response = await fetch(DB_URL + "scores.json");
                const data = await response.json();
                if (data) {
                    const sorted = Object.values(data).sort((a,b) => b.score - a.score).slice(0, 5);
                    list.innerHTML = sorted.map((s, i) => `<div class="lb-item"><span>${i+1}. ${s.name || "Anon"}</span><span>${s.score || 0}</span></div>`).join('');
                } else { list.innerHTML = "No global records found."; }
            } catch(e) { list.innerHTML = "Connection Error."; }
        }

        function closeLeaderboard() { document.getElementById("leaderboard-screen").style.display = "none"; }

        function attemptStart() {
            const name = document.getElementById("playerName").value.trim();
            if (name.length < 2) { alert(startRoasts[Math.floor(Math.random()*startRoasts.length)]); return; }
            currentPlayer = name;
            initAudio(); 
            if (audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById("start-screen").style.display = "none";
            gameRunning = true; 
            createFood(); 
            gameLoop();
        }

        function createFood() {
            foodX = Math.floor(Math.random() * 39) * 20;
            foodY = Math.floor(Math.random() * 29) * 20;
            wasNear = false;
        }

        function gameLoop() {
            if (!gameRunning || isPaused) return;
            let speed = isRage ? 45 : Math.max(55, 150 - (totalScore/3));
            
            setTimeout(() => {
                ctx.fillStyle = "#0f0524"; ctx.fillRect(0, 0, 800, 600);
                if(ghostPath[frame]) {
                    ctx.fillStyle = "rgba(0, 242, 255, 0.1)";
                    ghostPath[frame].forEach(p => ctx.fillRect(p.x, p.y, 18, 18));
                }
                let nextX = snake[0].x + dx; let nextY = snake[0].y + dy;
                let dist = Math.sqrt(Math.pow(nextX - foodX, 2) + Math.pow(nextY - foodY, 2));

                if (dist < 35 && (nextX !== foodX || nextY !== foodY)) wasNear = true;
                else if (wasNear && dist > 45) {
                    toxicity = Math.min(100, toxicity + 20); 
                    missCombo++;
                    if (missCombo >= 2) {
                        chatMsg = missRoasts[Math.floor(Math.random()*missRoasts.length)];
                        chatTimer = 25;
                    }
                    wasNear = false;
                }

                isRage = toxicity >= 100;
                document.getElementById("toxic-bar").style.height = toxicity + "%";
                ctx.fillStyle = isRage ? "#ff0055" : "#00f2ff";
                ctx.beginPath(); ctx.arc(foodX+10, foodY+10, 8, 0, Math.PI*2); ctx.fill();

                const head = { x: nextX, y: nextY };
                snake.unshift(head);
                currentPath.push(JSON.parse(JSON.stringify(snake)));

                if (head.x === foodX && head.y === foodY) {
                    totalScore += 10;
                    toxicity = Math.max(0, toxicity - 40);
                    missCombo = 0;
                    sfx(600, 900); // Eat sound
                    document.getElementById("scoreVal").innerText = totalScore;
                    fetchGlobalHigh();
                    createFood();
                } else { snake.pop(); }

                if (head.x < 0 || head.x >= 800 || head.y < 0 || head.y >= 600 || snake.slice(1).some(p => p.x === head.x && p.y === head.y)) {
                    sfx(150, 50); // Crash sound
                    handleGameOver(); return;
                }

                snake.forEach((p, i) => {
                    ctx.fillStyle = isRage ? "#ff0055" : (i === 0 ? "#00f2ff" : "#7000ff");
                    ctx.fillRect(p.x, p.y, 18, 18);
                });

                if (chatTimer > 0) {
                    ctx.fillStyle = "white"; ctx.font = "13px Arial"; ctx.textAlign = "center";
                    ctx.fillText(chatMsg, snake[0].x + 10, snake[0].y - 15);
                    chatTimer--;
                }
                frame++;
                gameLoop();
            }, speed);
        }

        async function handleGameOver() {
            gameRunning = false;
            const localHigh = parseInt(localStorage.getItem("snakeHighScore") || 0);
            let roast;
            if (totalScore > localHigh) {
                roast = backhandedPraise[Math.floor(Math.random()*backhandedPraise.length)];
                localStorage.setItem("snakeHighScore", totalScore);
                localStorage.setItem("ghostData", JSON.stringify(currentPath));
            } else {
                roast = crashRoasts[Math.floor(Math.random()*crashRoasts.length)];
            }
            await saveScore(currentPlayer, totalScore);
            setTimeout(() => {
                alert(roast.toUpperCase() + "\n\nFINAL SCORE: " + totalScore);
                location.reload();
            }, 100);
        }

        function togglePause() { isPaused = !isPaused; document.getElementById("pause-overlay").style.display = isPaused ? "block" : "none"; if(!isPaused) gameLoop(); }
        
        document.addEventListener("keydown", e => {
            if ([32, 37, 38, 39, 40].includes(e.keyCode)) e.preventDefault();
            if (e.keyCode === 80) togglePause();
            if (isPaused || !gameRunning) return;
            if (e.keyCode === 37 && dx === 0) { dx = -20; dy = 0; }
            if (e.keyCode === 38 && dy === 0) { dx = 0; dy = -20; }
            if (e.keyCode === 39 && dx === 0) { dx = 20; dy = 0; }
            if (e.keyCode === 40 && dy === 0) { dx = 0; dy = 20; }
        });

        window.onload = fetchGlobalHigh;
    </script>
</body>
</html>
