<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>The Snake â€“ Solo & Friends 1v1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#0b0620;
  color:#00f2ff;
  font-family:Courier New, monospace;
  text-align:center;
}
canvas{
  background:#050012;
  border:4px solid #00f2ff;
  display:block;
  margin:auto;
}
.panel{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#050012;
  border:3px solid #00f2ff;
  padding:20px;
}
button,input{
  margin:5px;
  padding:10px;
  background:#111;
  border:2px solid #00f2ff;
  color:#00f2ff;
}
#menu,#friendsPanel,#chatPanel,#resultPanel{display:none}
#chatLog{
  height:150px;
  overflow-y:auto;
  border:1px solid #00f2ff;
  padding:5px;
  margin-bottom:5px;
}
</style>
</head>

<body>

<canvas id="game" width="600" height="400"></canvas>

<div id="menu" class="panel">
  <h2>THE SNAKE</h2>
  <input id="playerName" placeholder="Your name">
  <br>
  <button onclick="startSolo()">SOLO</button>
  <button onclick="openFriends()">1v1 WITH FRIEND</button>
</div>

<div id="friendsPanel" class="panel">
  <h3>Friends</h3>
  <div id="friendsList"></div>
  <input id="friendInput" placeholder="Add friend">
  <br>
  <button onclick="addFriend()">ADD</button>
  <button onclick="backMenu()">BACK</button>
</div>

<div id="chatPanel" class="panel">
  <h3 id="chatTitle"></h3>
  <div id="chatLog"></div>
  <input id="chatMsg" placeholder="Message">
  <button onclick="sendMsg()">SEND</button>
  <br><br>
  <button onclick="invite1v1()">INVITE 1v1</button>
  <button onclick="closeChat()">CLOSE</button>
</div>

<div id="resultPanel" class="panel">
  <h2 id="resultText"></h2>
  <p id="scoreText"></p>
  <button onclick="rematch()">REMATCH</button>
  <button onclick="backMenu()">MENU</button>
  <button onclick="share()">WHATSAPP</button>
</div>

<script>
/* ================= CONFIG ================= */
const DB = "YOUR_FIREBASE_URL"; // ðŸ”´ CHANGE THIS

/* ================= GLOBAL ================= */
const cvs=document.getElementById("game");
const ctx=cvs.getContext("2d");

let me="", friend="", room="";
let mode="menu";
let snake=[], enemy=[], food={};
let dir={x:20,y:0}, edir={x:-20,y:0};
let score=0, escore=0;
let running=false;

/* ================= ROASTS ================= */
const soloRoasts=["Too Easy ðŸ˜Ž","Still Hungry ðŸ","Keep Going!"];
const winRoasts=["ABSOLUTE DOMINATION ðŸ˜ˆ","YOU OWNED HIM","EZ WIN"];
const loseRoasts=["SENT BACK TO PRACTICE","OUTPLAYED","TRY AGAIN"];

/* ================= INIT ================= */
menu.style.display="block";

/* ================= MENU ================= */
function startSolo(){
  me=playerName.value.trim();
  if(!me)return alert("Enter name");
  mode="solo";
  startGame();
}
function openFriends(){
  me=playerName.value.trim();
  if(!me)return alert("Enter name");
  menu.style.display="none";
  friendsPanel.style.display="block";
  loadFriends();
}
function backMenu(){location.reload();}

/* ================= FRIEND MEMORY ================= */
async function addFriend(){
  const f=friendInput.value.trim();
  if(!f)return;
  await fetch(DB+`friends/${me}/${f}.json`,{method:"PUT",body:"true"});
  loadFriends();
}
async function loadFriends(){
  friendsList.innerHTML="";
  const data=await fetch(DB+`friends/${me}.json`).then(r=>r.json())||{};
  Object.keys(data).forEach(f=>{
    const b=document.createElement("button");
    b.textContent=f;
    b.onclick=()=>openChat(f);
    friendsList.appendChild(b);
  });
}

/* ================= CHAT ================= */
function openChat(f){
  friend=f;
  friendsPanel.style.display="none";
  chatPanel.style.display="block";
  chatTitle.innerText="Chat with "+f;
  listenChat();
}
function closeChat(){
  chatPanel.style.display="none";
  friendsPanel.style.display="block";
}
function sendMsg(){
  if(!chatMsg.value)return;
  fetch(DB+`chat/${me}_${friend}/${Date.now()}.json`,{
    method:"PUT",
    body:JSON.stringify({from:me,text:chatMsg.value})
  });
  chatMsg.value="";
}
function listenChat(){
  setInterval(async()=>{
    const data=await fetch(DB+`chat/${me}_${friend}.json`).then(r=>r.json())||{};
    chatLog.innerHTML="";
    Object.values(data).forEach(m=>{
      chatLog.innerHTML+=`<div><b>${m.from}:</b> ${m.text}</div>`;
    });
    chatLog.scrollTop=9999;
  },1000);
}

/* ================= 1v1 ================= */
async function invite1v1(){
  room=me+"_"+friend;
  await fetch(DB+`rooms/${room}.json`,{
    method:"PUT",
    body:JSON.stringify({p1:me,p2:friend,status:"start"})
  });
  start1v1();
}
function start1v1(){
  mode="1v1";
  chatPanel.style.display="none";
  startGame();
}

/* ================= GAME ================= */
function startGame(){
  snake=[{x:200,y:200}];
  enemy=[{x:400,y:200}];
  score=0;escore=0;
  spawnFood();
  running=true;
  loop();
}
function spawnFood(){
  food.x=Math.floor(Math.random()*29)*20;
  food.y=Math.floor(Math.random()*19)*20;
}
function loop(){
  if(!running)return;
  ctx.fillStyle="#050012";
  ctx.fillRect(0,0,600,400);

  draw(food,"#0ff");
  move(snake,dir);
  if(mode==="1v1") move(enemy,edir);

  if(hit(snake[0],food)){score++;spawnFood();}
  if(mode==="1v1" && hit(enemy[0],food)){escore++;spawnFood();}

  if(mode==="1v1"){
    if(collide(snake[0],enemy)) endGame(false);
    if(collide(enemy[0],snake)) endGame(true);
  }

  drawSnake(snake,"#0ff");
  if(mode==="1v1") drawSnake(enemy,"#f05");

  setTimeout(loop,90);
}

/* ================= END ================= */
function endGame(win){
  running=false;
  resultPanel.style.display="block";
  resultText.innerText=win
    ? winRoasts[Math.floor(Math.random()*winRoasts.length)]
    : loseRoasts[Math.floor(Math.random()*loseRoasts.length)];
  scoreText.innerText=`${me}: ${score} | ${friend}: ${escore}`;
}
function rematch(){startGame();}

/* ================= DRAW ================= */
function move(s,d){
  let h=s[0];
  s.unshift({x:(h.x+d.x+600)%600,y:(h.y+d.y+400)%400});
  s.pop();
}
function draw(o,c){ctx.fillStyle=c;ctx.fillRect(o.x,o.y,18,18);}
function drawSnake(s,c){s.forEach(p=>draw(p,c));}
function hit(a,b){return a.x===b.x && a.y===b.y;}
function collide(h,s){return s.some(p=>p!==s[0]&&hit(h,p));}

/* ================= SHARE ================= */
function share(){
  window.open("https://wa.me/?text="+encodeURIComponent(
    `ðŸ Snake 1v1 Result\n${me}: ${score}\n${friend}: ${escore}`
  ));
}

/* ================= CONTROLS ================= */
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp")dir={x:0,y:-20};
  if(e.key==="ArrowDown")dir={x:0,y:20};
  if(e.key==="ArrowLeft")dir={x:-20,y:0};
  if(e.key==="ArrowRight")dir={x:20,y:0};
});
</script>
</body>
</html>

